<!DOCTYPE html>

<html>

<head>
    <title>Edit Habits</title>

    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Figtree:ital,wght@0,300..900;1,300..900&display=swap"
        rel="stylesheet">
    
     <!-- For the AM/PM Toggle on the Clock -->
     <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/flatpickr/dist/flatpickr.min.css">
     <script src="https://cdn.jsdelivr.net/npm/flatpickr"></script>

    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />

    <link rel="stylesheet" type="text/css" href="habits.css" />
    <link rel="stylesheet" href="../main.css">
</head>

<body>
    <div id="mobile">
        <header>
            <h1>Edit Habit</h1>     
        </header>

        <main>
            <div id="Edit-Habit">
                <!-- Habit Name -->
                <label for="habitname">Habit Name </label>
                <input class= "not-freq" type="text" id="habitname" name="Habit" placeholder="Enter the habit you want to create."><br>
                <br>
    
                <!-- Frequency Buttons -->
                <label for="freq">Frequency </label>

                <div id="freq-btn">
                  <input type="radio" id="freq-button-group-daily"  name="Frequency" value="Daily">
                  <label for="daily">Daily</label>
      
                  <input type="radio" id="freq-button-group-weekly" name="Frequency" value="Weekly">
                  <label for="weekly">Weekly</label>
      
                  <input type="radio" id="freq-button-group-custom" name="Frequency" value="Custom">
                  <label for="custom">Custom</label>
                </div>
                
                <div id="custom-input" class = "not-freq">
                  <input type="text" placeholder="Enter additional info">
                </div>
                <br>
                
                <!-- Preferred Time of Day -->
                <label for="tod">Preferred Time of Day </label>
                <input class= "not-freq" id="timepicker" name="Preferred Time of Day" type="text" placeholder="Select the time of day you would like to do this habit.">
                <br>
    
                <!-- Target-->
                <label for="target">Target </label>
                <input class= "not-freq" type="text" id="target" name="Target" placeholder="Enter your target for this habit.">
                <br>
    
                <!-- Description -->
                <label for="notes">Description/Additional Notes </label>
                <input class= "not-freq" type="text" id="notes" name="Description/Additional Notes" placeholder="Add any description/additional notes.">
                <br><br>

                <button class="btn btn-primary" id="Done">Done!</button>
            </div>

        </main>



        <script>
            flatpickr("#timepicker", {
                enableTime: true,
                noCalendar: true,
                dateFormat: "h:i K", // 12-hour with AM/PM
            });

            document.querySelectorAll('input[type="radio"]').forEach(function(radio) {
              const customDiv = document.getElementById("custom-input");
              radio.addEventListener('click', function() {
                if (this.value == "Custom") {
                  customDiv.style.display = "block";
                } else {
                  customDiv.style.display = "none";
                }
              });
            });

            // General Function structure credited to ChatGPT to understand how to move things between several html files like this
            // window.addEventListener("DOMContentLoaded", () => {
            // const headerContainer = document.getElementsByClassName("curr-habits")[0];
            // const wentToAddHabit = JSON.parse(localStorage.getItem("cameBack?")); 
            // if (wentToAddHabit) {
            //     const habitList = JSON.parse(localStorage.getItem("habitData")); 

            //     if (habitList.length > 0) {
            //     habitList.forEach(habit => {
            //         const habitDiv = document.createElement('div');  
            //         let html = "";
            //         for (let key in habit) {
            //         html += `<p><strong>${key}:</strong> ${habit[key]}</p><br>`;
            //         }
            //         habitDiv.innerHTML = html + `<a href="edithabits.html"> <button id="Edit">Edit Habit</button> </a>`;
            //         headerContainer.appendChild(habitDiv);
            //         localStorage.removeItem("cameBack?");
            //     });
            //     }
                
            // }
            // });




          // General Function structure credited to ChatGPT to understand how to move things between several html files like this
            const editDiv = document.getElementById("Edit-Habit");
            const habitInput = JSON.parse(localStorage.getItem("edit")); 
            const html = habitInput.htmlContent;
            const match = html.match(/<\/strong>\s*(.+)<\/p>/);

            if (habitInput) {
              const freqValue = habitInput.Frequency || "";
              if (freqValue) {
                  const radio = document.querySelector(`input[name="Frequency"][value="${freqValue}"]`);
                  if (radio) {
                    radio.checked = true;
                  }
              }

              // Prefill the input fields with the habit data
              document.getElementById("habitname").value = habitInput.Habit || "";
              document.getElementById("timepicker").value = habitInput["Preferred Time of Day"] || "";
              document.getElementById("target").value = habitInput.Target || "";
              document.getElementById("notes").value = habitInput["Description/Additional Notes"] || "";
            }

            localStorage.removeItem("edit");
            

            // General Function structure credited to ChatGPT to understand how to move things between several html files like this
            function habitStorer() {
              var habitDiv = document.getElementById("Add-Habit");
              var inputs = habitDiv.querySelectorAll("input");

              let data = {};
              inputs.forEach(input => {
                  if (input.name == "Frequency") {
                      const reminderFreq = document.querySelector('input[name="Frequency"]:checked');
                      data[input.name] = reminderFreq.value;
                  } else {
                      data[input.name] = input.value;
                  }
              });

              let habitList = JSON.parse(localStorage.getItem("habitData")) || [];
              habitList.push(data);

              localStorage.setItem("habitData", JSON.stringify(habitList));
            }


            document.getElementById('Done').addEventListener('click', function() {
                habitStorer();
                localStorage.setItem("cameBack?", true);
                location.assign("habits.html");
            });
        </script>

        
        <script src="../elements/navbar.js"></script>
        <custom-navbar></custom-navbar>
    </div>
</body>
</html>